name: auto-merge

on:
  workflow_dispatch:

env:
  ORG: "awslabs"
  TEAM: "aws-lambda-powertools-python"

jobs:
  maintainers:
    runs-on: ubuntu-latest
    steps:
      - name: Setup tmate session
        uses: mxschmitt/action-tmate@v3
      - name: Get latest list of maintainers
        run: |
          gh api graphql \
            -F org=$ORG \
            -F team=$TEAM \
            -f query='
                query($org: String!, $team: String!) { 
                    organization(login:$org) {
                        team(slug:$team) {
                            members {
                                edges {
                                    node {
                                        login
                                    }
                                }
                            }
                        }
                    }
                }
            ' > data.json
            cat data.json
            MAINTAINERS=$(jq -c '.data.organization.team.members.edges | map(.node.login)' data.json)
            echo 'MAINTAINERS='$MAINTAINERS >> $GITHUB_ENV
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      - name: List maintainers
        run: echo $MAINTAINERS
